{{ $currentPageUrl := .RelPermalink }}
{{ if .Params.series }}
<section class="see-also">
  {{ range .Params.series }}
    {{ $seriesLabel := . }}
    {{ $name := . | anchorize }}
    {{ $series := index $.Site.Taxonomies.series $name }}
    {{ with $series }}
      {{ $seriesPages := (.Pages.ByParam "series_weight") }}
      {{ with $seriesPages }}
        {{ with .Next $ }}
          <a href="{{ .RelPermalink }}">Previous: {{ .Title }}</a>
        {{ end }}
        {{ with .Prev $ }}
          <a href="{{ .RelPermalink }}">Next: {{ .Title }}</a>
        {{ end }}
      {{ end }}
      {{ if gt (len $seriesPages) 1 }}
      <h3 id="{{ i18n "see_also" | default "See also in" | anchorize }}-{{ anchorize $seriesLabel | safeURL }}">
        {{ i18n "see_also" | default "See also in" }} {{ $seriesLabel }}
        <a class="heading-link" href="#{{ i18n "see_also" | default "See also in" | anchorize }}-{{ anchorize $seriesLabel | safeURL }}">
          <i class="fa-solid fa-link" aria-hidden="true" title="{{ i18n "link_to_heading" | default "Link to heading" }}"></i>
          <span class="sr-only">{{ i18n "link_to_heading" | default "Link to heading" }}</span>
        </a>
      </h3>
      <nav>
        <ul>
        {{ $maxItems := $.Site.Params.maxSeeAlsoItems | default 5 }}
        {{ range first (add $maxItems 1) $seriesPages }}
          {{ if ne .RelPermalink $currentPageUrl }}
            <li>
              <a href="{{ .Params.externalLink | default .RelPermalink }}">{{ .Title }}</a>
            </li>
          {{ end }}
        {{ end }}
        </ul>
      </nav>
      {{ end }}
    {{ end }}
  {{ end }}
</section>
{{ end }}
